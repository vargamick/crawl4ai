<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crawl4AI Scraper - Advanced Embed Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .demo-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .demo-panel h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        #scraper-container-1,
        #scraper-container-2 {
            min-height: 400px;
            margin-top: 15px;
        }
        
        .controls-panel {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .controls-panel h3 {
            margin: 0 0 15px 0;
            color: #ecf0f1;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-group label {
            color: #bdc3c7;
            min-width: 120px;
        }
        
        .control-group input,
        .control-group select,
        .control-group button {
            padding: 8px 12px;
            border: 1px solid #34495e;
            border-radius: 4px;
            background: #34495e;
            color: white;
        }
        
        .control-group button {
            background: #3498db;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .control-group button:hover {
            background: #2980b9;
        }
        
        .events-log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .events-log .event {
            margin-bottom: 5px;
            padding: 2px 0;
            border-bottom: 1px solid #34495e;
        }
        
        .events-log .event-time {
            color: #95a5a6;
        }
        
        .events-log .event-type {
            color: #3498db;
            font-weight: bold;
        }
        
        .events-log .event-error {
            color: #e74c3c;
        }
        
        .events-log .event-success {
            color: #2ecc71;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üï∑Ô∏è Crawl4AI Scraper Frontend</h1>
            <p>Advanced Embed Example - Multiple instances with custom configuration</p>
        </div>
        
        <!-- Control Panel -->
        <div class="controls-panel">
            <h3>üéõÔ∏è Instance Controls</h3>
            <div class="control-group">
                <label>API URL:</label>
                <input type="text" id="apiUrl" value="http://localhost:8000" />
                <button onclick="updateConfiguration()">Update Config</button>
            </div>
            <div class="control-group">
                <label>Instance:</label>
                <select id="instanceSelect">
                    <option value="1">Instance 1 (Standard)</option>
                    <option value="2">Instance 2 (Shadow DOM)</option>
                </select>
                <button onclick="reloadInstance()">Reload Instance</button>
                <button onclick="destroyInstance()">Destroy Instance</button>
            </div>
            <div class="control-group">
                <button onclick="triggerBulkScraping()">Bulk Scrape</button>
                <button onclick="showAllStats()">Show All Stats</button>
                <button onclick="clearEvents()">Clear Events</button>
            </div>
        </div>
        
        <!-- Scraper Instances -->
        <div class="demo-grid">
            <div class="demo-panel">
                <h3>üîπ Standard Instance</h3>
                <p>Normal DOM integration with custom styling</p>
                <div id="scraper-container-1"></div>
            </div>
            
            <div class="demo-panel">
                <h3>üî∏ Shadow DOM Instance</h3>
                <p>Isolated using Shadow DOM (if supported)</p>
                <div id="scraper-container-2"></div>
            </div>
        </div>
        
        <!-- Events Log -->
        <div class="events-log" id="eventsLog">
            <div class="event">
                <span class="event-time">[Initialized]</span> 
                <span class="event-type">INFO:</span> 
                Events will appear here...
            </div>
        </div>
    </div>
    
    <!-- Load the Crawl4AI scraper library -->
    <script src="../dist/crawl4ai-scraper.min.js"></script>
    <script>
        // Global instances storage
        const instances = {};
        
        // Event logging
        function logEvent(type, message, data = null) {
            const eventsLog = document.getElementById('eventsLog');
            const timestamp = new Date().toLocaleTimeString();
            const eventDiv = document.createElement('div');
            eventDiv.className = 'event';
            
            let cssClass = '';
            switch (type.toLowerCase()) {
                case 'error': cssClass = 'event-error'; break;
                case 'success': cssClass = 'event-success'; break;
                default: cssClass = 'event-type';
            }
            
            eventDiv.innerHTML = `
                <span class="event-time">[${timestamp}]</span> 
                <span class="${cssClass}">${type.toUpperCase()}:</span> 
                ${message}
                ${data ? `<br><span style="color:#7f8c8d;margin-left:20px;">${JSON.stringify(data, null, 2)}</span>` : ''}
            `;
            
            eventsLog.appendChild(eventDiv);
            eventsLog.scrollTop = eventsLog.scrollHeight;
        }
        
        // Initialize instances
        async function initializeInstances() {
            try {
                // Instance 1: Standard DOM
                logEvent('INFO', 'Initializing standard DOM instance...');
                instances.instance1 = await Crawl4AIScraper.embed('#scraper-container-1', {
                    apiUrl: 'http://localhost:8000',
                    apiPrefix: '/api/scraper',
                    cssPrefix: 'c4ai-std-',
                    enableShadowDOM: false,
                    theme: 'default'
                });
                
                // Instance 2: Shadow DOM
                logEvent('INFO', 'Initializing Shadow DOM instance...');
                instances.instance2 = await Crawl4AIScraper.embed('#scraper-container-2', {
                    apiUrl: 'http://localhost:8000',
                    apiPrefix: '/api/scraper',
                    cssPrefix: 'c4ai-shadow-',
                    enableShadowDOM: true,
                    theme: 'compact'
                });
                
                // Setup event listeners for both instances
                setupEventListeners();
                
                logEvent('SUCCESS', 'Both instances initialized successfully');
                
            } catch (error) {
                logEvent('ERROR', 'Failed to initialize instances', { error: error.message });
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            Object.entries(instances).forEach(([key, instance]) => {
                const instanceName = key === 'instance1' ? 'Standard' : 'Shadow DOM';
                
                instance.addEventListener('initialized', (event) => {
                    logEvent('SUCCESS', `${instanceName} instance initialized`);
                });
                
                instance.addEventListener('error', (event) => {
                    logEvent('ERROR', `${instanceName} error: ${event.detail.error.message}`);
                });
                
                instance.addEventListener('scrapingStarted', (event) => {
                    logEvent('INFO', `${instanceName} scraping started`, {
                        config: event.detail.config
                    });
                });
                
                instance.addEventListener('statsDisplayed', (event) => {
                    logEvent('INFO', `${instanceName} stats displayed`, {
                        totalResults: event.detail.stats.total_results
                    });
                });
                
                instance.addEventListener('configured', (event) => {
                    logEvent('INFO', `${instanceName} configuration updated`);
                });
            });
        }
        
        // Control functions
        function updateConfiguration() {
            const apiUrl = document.getElementById('apiUrl').value;
            const instanceId = document.getElementById('instanceSelect').value;
            const instanceKey = `instance${instanceId}`;
            
            if (instances[instanceKey]) {
                instances[instanceKey].configure({
                    apiUrl: apiUrl
                });
                logEvent('INFO', `Updated configuration for ${instanceKey}`, { apiUrl });
            }
        }
        
        function reloadInstance() {
            const instanceId = document.getElementById('instanceSelect').value;
            const instanceKey = `instance${instanceId}`;
            const containerId = `#scraper-container-${instanceId}`;
            
            if (instances[instanceKey]) {
                // Destroy existing instance
                instances[instanceKey].destroy();
                delete instances[instanceKey];
                
                // Recreate instance
                const config = {
                    apiUrl: document.getElementById('apiUrl').value,
                    apiPrefix: '/api/scraper',
                    cssPrefix: instanceId === '1' ? 'c4ai-std-' : 'c4ai-shadow-',
                    enableShadowDOM: instanceId === '2'
                };
                
                Crawl4AIScraper.embed(containerId, config).then(instance => {
                    instances[instanceKey] = instance;
                    setupEventListeners();
                    logEvent('SUCCESS', `Reloaded ${instanceKey}`);
                }).catch(error => {
                    logEvent('ERROR', `Failed to reload ${instanceKey}`, { error: error.message });
                });
            }
        }
        
        function destroyInstance() {
            const instanceId = document.getElementById('instanceSelect').value;
            const instanceKey = `instance${instanceId}`;
            
            if (instances[instanceKey]) {
                instances[instanceKey].destroy();
                delete instances[instanceKey];
                logEvent('INFO', `Destroyed ${instanceKey}`);
            }
        }
        
        function triggerBulkScraping() {
            Object.entries(instances).forEach(([key, instance]) => {
                instance.triggerFullScraping().then(() => {
                    logEvent('SUCCESS', `Bulk scraping started on ${key}`);
                }).catch(error => {
                    logEvent('ERROR', `Bulk scraping failed on ${key}`, { error: error.message });
                });
            });
        }
        
        function showAllStats() {
            Object.entries(instances).forEach(([key, instance]) => {
                instance.showScraperStats();
            });
        }
        
        function clearEvents() {
            const eventsLog = document.getElementById('eventsLog');
            eventsLog.innerHTML = '<div class="event"><span class="event-time">[Cleared]</span> <span class="event-type">INFO:</span> Events log cleared</div>';
        }
        
        // Initialize when page loads
        window.addEventListener('load', initializeInstances);
    </script>
</body>
</html>
