<!-- Configuration Modal Component -->
<div class="modal" id="scraperConfigModal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>‚öôÔ∏è Scraper Configuration</h3>
            <span class="close" onclick="Crawl4AIScraper.closeConfigModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="scraperConfigForm" onsubmit="Crawl4AIScraper.saveConfiguration(event)">
                <div class="config-section">
                    <h4>üì° API Configuration</h4>
                    <div class="form-group">
                        <label for="configApiUrl">API Base URL:</label>
                        <input type="url" id="configApiUrl" class="form-control" value="http://localhost:8000" 
                               placeholder="http://localhost:8000" required>
                    </div>
                    <div class="form-group">
                        <label for="configApiPrefix">API Prefix:</label>
                        <input type="text" id="configApiPrefix" class="form-control" value="/api/scraper" 
                               placeholder="/api/scraper">
                    </div>
                </div>

                <div class="config-section">
                    <h4>üîß Scraping Settings</h4>
                    <div class="form-group">
                        <label for="configMaxItems">Max Items (Quick Scrape):</label>
                        <input type="number" id="configMaxItems" class="form-control" value="100" 
                               min="1" max="10000" placeholder="100">
                    </div>
                    <div class="form-group">
                        <label for="configTimeout">Request Timeout (seconds):</label>
                        <input type="number" id="configTimeout" class="form-control" value="30" 
                               min="5" max="300" placeholder="30">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="configIncludeMedia" checked>
                            Include Media Files
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="configIncludeDocuments" checked>
                            Include Documents
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="configIncludeMetadata" checked>
                            Include Metadata
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h4>üé® UI Settings</h4>
                    <div class="form-group">
                        <label for="configAutoRefresh">Auto Refresh Interval (seconds):</label>
                        <input type="number" id="configAutoRefresh" class="form-control" value="30" 
                               min="5" max="300" placeholder="30">
                    </div>
                    <div class="form-group">
                        <label for="configResultsPerPage">Results Per Page:</label>
                        <select id="configResultsPerPage" class="form-control">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="configEnableNotifications" checked>
                            Enable Browser Notifications
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h4>üîê Authentication (Optional)</h4>
                    <div class="form-group">
                        <label for="configApiKey">API Key:</label>
                        <input type="password" id="configApiKey" class="form-control" 
                               placeholder="Enter API key if required">
                    </div>
                    <div class="form-group">
                        <label for="configAuthToken">Bearer Token:</label>
                        <input type="password" id="configAuthToken" class="form-control" 
                               placeholder="Enter bearer token if required">
                    </div>
                </div>

                <div class="config-section">
                    <h4>‚ö° Performance Settings</h4>
                    <div class="form-group">
                        <label for="configConcurrency">Max Concurrent Requests:</label>
                        <input type="number" id="configConcurrency" class="form-control" value="5" 
                               min="1" max="20" placeholder="5">
                    </div>
                    <div class="form-group">
                        <label for="configRetryAttempts">Retry Attempts:</label>
                        <input type="number" id="configRetryAttempts" class="form-control" value="3" 
                               min="0" max="10" placeholder="3">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="configEnableCache" checked>
                            Enable Response Caching
                        </label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="Crawl4AIScraper.closeConfigModal()">
                Cancel
            </button>
            <button type="button" class="btn btn-warning" onclick="Crawl4AIScraper.resetConfiguration()">
                Reset to Defaults
            </button>
            <button type="submit" form="scraperConfigForm" class="btn btn-primary">
                Save Configuration
            </button>
        </div>
    </div>
</div>

<style>
/* Additional styles for config modal */
.config-section {
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid #dee2e6;
}

.config-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.config-section h4 {
    color: #495057;
    margin: 0 0 15px 0;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    color: #495057;
    font-weight: 500;
}

.form-group label input[type="checkbox"] {
    margin-right: 8px;
    margin-bottom: 0;
}

.form-control {
    width: 100%;
    padding: 8px 12px;
    font-size: 14px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    transition: border-color 0.15s ease-in-out;
    box-sizing: border-box;
}

.form-control:focus {
    border-color: #0066cc;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(0, 102, 204, 0.25);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        margin: 2% auto;
        max-height: 95vh;
    }
    
    .config-section {
        margin-bottom: 20px;
    }
}
</style>

<script>
// Configuration modal functionality
if (typeof window !== 'undefined') {
    // Extend global Crawl4AIScraper object with configuration methods
    window.Crawl4AIScraperConfig = {
        // Save configuration
        saveConfiguration: function(event) {
            if (event) event.preventDefault();
            
            const config = this.getFormConfiguration();
            
            // Apply configuration to current instance
            if (window.Crawl4AIScraperInstances) {
                Object.values(window.Crawl4AIScraperInstances).forEach(instance => {
                    if (instance && typeof instance.configure === 'function') {
                        instance.configure(config);
                    }
                });
            }
            
            // Store in localStorage for persistence
            localStorage.setItem('crawl4ai-scraper-config', JSON.stringify(config));
            
            // Close modal
            this.closeConfigModal();
            
            // Show success message
            console.log('Configuration saved successfully');
        },
        
        // Reset to defaults
        resetConfiguration: function() {
            if (confirm('Reset all settings to default values?')) {
                this.loadDefaultConfiguration();
            }
        },
        
        // Get configuration from form
        getFormConfiguration: function() {
            return {
                apiUrl: document.getElementById('configApiUrl').value,
                apiPrefix: document.getElementById('configApiPrefix').value,
                maxItems: parseInt(document.getElementById('configMaxItems').value),
                timeout: parseInt(document.getElementById('configTimeout').value),
                includeMedia: document.getElementById('configIncludeMedia').checked,
                includeDocuments: document.getElementById('configIncludeDocuments').checked,
                includeMetadata: document.getElementById('configIncludeMetadata').checked,
                autoRefreshInterval: parseInt(document.getElementById('configAutoRefresh').value) * 1000,
                resultsPerPage: parseInt(document.getElementById('configResultsPerPage').value),
                enableNotifications: document.getElementById('configEnableNotifications').checked,
                apiKey: document.getElementById('configApiKey').value,
                authToken: document.getElementById('configAuthToken').value,
                maxConcurrency: parseInt(document.getElementById('configConcurrency').value),
                retryAttempts: parseInt(document.getElementById('configRetryAttempts').value),
                enableCache: document.getElementById('configEnableCache').checked
            };
        },
        
        // Load configuration into form
        loadConfiguration: function(config) {
            document.getElementById('configApiUrl').value = config.apiUrl || 'http://localhost:8000';
            document.getElementById('configApiPrefix').value = config.apiPrefix || '/api/scraper';
            document.getElementById('configMaxItems').value = config.maxItems || 100;
            document.getElementById('configTimeout').value = config.timeout || 30;
            document.getElementById('configIncludeMedia').checked = config.includeMedia !== false;
            document.getElementById('configIncludeDocuments').checked = config.includeDocuments !== false;
            document.getElementById('configIncludeMetadata').checked = config.includeMetadata !== false;
            document.getElementById('configAutoRefresh').value = Math.floor((config.autoRefreshInterval || 30000) / 1000);
            document.getElementById('configResultsPerPage').value = config.resultsPerPage || 10;
            document.getElementById('configEnableNotifications').checked = config.enableNotifications !== false;
            document.getElementById('configApiKey').value = config.apiKey || '';
            document.getElementById('configAuthToken').value = config.authToken || '';
            document.getElementById('configConcurrency').value = config.maxConcurrency || 5;
            document.getElementById('configRetryAttempts').value = config.retryAttempts || 3;
            document.getElementById('configEnableCache').checked = config.enableCache !== false;
        },
        
        // Load default configuration
        loadDefaultConfiguration: function() {
            const defaults = {
                apiUrl: 'http://localhost:8000',
                apiPrefix: '/api/scraper',
                maxItems: 100,
                timeout: 30,
                includeMedia: true,
                includeDocuments: true,
                includeMetadata: true,
                autoRefreshInterval: 30000,
                resultsPerPage: 10,
                enableNotifications: true,
                apiKey: '',
                authToken: '',
                maxConcurrency: 5,
                retryAttempts: 3,
                enableCache: true
            };
            
            this.loadConfiguration(defaults);
        },
        
        // Close modal
        closeConfigModal: function() {
            const modal = document.getElementById('scraperConfigModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    };
    
    // Initialize configuration on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Load saved configuration from localStorage
        const savedConfig = localStorage.getItem('crawl4ai-scraper-config');
        if (savedConfig) {
            try {
                const config = JSON.parse(savedConfig);
                window.Crawl4AIScraperConfig.loadConfiguration(config);
            } catch (error) {
                console.warn('Failed to load saved configuration:', error);
                window.Crawl4AIScraperConfig.loadDefaultConfiguration();
            }
        } else {
            window.Crawl4AIScraperConfig.loadDefaultConfiguration();
        }
    });
    
    // Add methods to global Crawl4AIScraper object
    if (window.Crawl4AIScraper) {
        window.Crawl4AIScraper.saveConfiguration = window.Crawl4AIScraperConfig.saveConfiguration.bind(window.Crawl4AIScraperConfig);
        window.Crawl4AIScraper.resetConfiguration = window.Crawl4AIScraperConfig.resetConfiguration.bind(window.Crawl4AIScraperConfig);
    }
}
</script>
